<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>JUST COM</title>
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b0e11;--panel:#0f1319;--card:#12161d;--muted:#9aa4b2;
  --text:#e7edf3;--line:#1c2430;--accent:#1f6feb;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;background:var(--bg);color:var(--text);
  font-family:'Prompt',sans-serif;
}
.container{max-width:1200px;margin:0 auto;padding:16px}
h1{font-size:22px;margin:12px 0 8px;font-weight:700}
.controls{display:flex;gap:12px;flex-wrap:wrap;margin:12px 0}
input,select{
  background:var(--panel);color:var(--text);border:1px solid var(--line);
  border-radius:10px;padding:10px 12px;outline:none
}
input{flex:1 1 280px}
#grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px;margin-top:12px}
.card{position:relative;border:1px solid var(--line);border-radius:14px;overflow:hidden;background:var(--card);cursor:pointer;transition:transform .15s}
.card:hover{transform:translateY(-4px)}
.card .thumb{width:100%;height:180px;object-fit:cover;background:#0e1217;display:block}
.card .ct{padding:12px}
.title{font-weight:700;margin:4px 0 6px}
.price{font-weight:800;margin-top:6px;color:var(--accent)}

#lightbox{
  position:fixed;inset:0;display:none;place-items:center;
  background:rgba(0,0,0,.8);z-index:9999;
}
#lightbox.open{display:grid}
.lbpanel{
  width:min(1000px,90vw);max-height:90vh;background:var(--panel);
  border:1px solid var(--line);border-radius:16px;overflow:hidden;
  display:grid;grid-template-columns:1fr 320px;position:relative;
}
.lbm{padding:14px;background:var(--card);border-right:1px solid var(--line);display:flex;flex-direction:column}
#lb-mainimg{width:100%;height:64vh;object-fit:contain;background:#0c1015;border-radius:12px}
#lb-thumbs{margin-top:10px;display:flex;gap:8px;overflow:auto}
#lb-thumbs img{width:64px;height:64px;object-fit:cover;border-radius:8px;border:1px solid var(--line);cursor:pointer}
#lb-thumbs img:hover{border-color:var(--accent)}
.lbr{padding:16px;overflow:auto}
#lb-title{font-weight:800;margin-bottom:8px}
#lb-desc{margin-top:10px;color:var(--muted);font-size:14px}
#lb-close{position:absolute;top:8px;right:10px;background:#0000;color:#fff;border:0;font-size:16px;cursor:pointer}
footer{text-align:center;color:var(--muted);font-size:13px;margin:30px 0}
</style>
</head>
<body>
<header style="text-align:center;padding:10px 0;">
  <img src="images/banner.jpg" alt="banner" style="max-width:100%;border-radius:12px;">
</header>

<div class="container">
  <h1>JUST COM</h1>
  <div class="controls">
    <input id="q" placeholder="ค้นหา: ชื่อ/แบรนด์/รุ่น...">
  </div>
  <div id="grid"></div>
</div>

<footer>© Copyright 2025 All Rights Reserved By Just Com.</footer>

<div id="lightbox">
  <div class="lbpanel">
    <button id="lb-close">ปิด ✕</button>
    <div class="lbm">
      <img id="lb-mainimg" alt="">
      <div id="lb-thumbs"></div>
    </div>
    <div class="lbr">
      <div id="lb-title"></div>
      <div id="lb-spec"></div>
      <div id="lb-desc"></div>
    </div>
  </div>
</div>

<script>
async function loadCSV(){
  const res = await fetch("data/justcom_inventory.csv?v="+Date.now());
  const text = await res.text();
  const rows = text.trim().split(/\n/).map(r=>r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(c=>c.replace(/^"|"$/g,'')));
  const headers = rows.shift();
  return rows.map(r=>Object.fromEntries(headers.map((h,i)=>[h.trim(),(r[i]||'').trim()])));
}
function render(list){
  const grid=document.getElementById('grid');
  grid.innerHTML='';
  list.forEach(it=>{
    const img=it["ลิงก์รูปภาพหลัก"];
    const div=document.createElement('div');
    div.className='card';
    div.innerHTML=`<img class='thumb' src='${img}'><div class='ct'><div class='title'>${it["ชื่อสินค้า"]}</div><div class='price'>${it["ราคา (THB)"]} บาท</div></div>`;
    div.onclick=()=>lb.open(it);
    grid.appendChild(div);
  });
}

// ---------- popup ----------
const lb={};
lb.open=function(item){
  const main=item["ลิงก์รูปภาพหลัก"];
  const more=(item["ลิงก์รูปภาพเพิ่มเติม (คั่นด้วย ,)"]||"").split(/[,，、\n]+/).map(s=>s.trim()).filter(Boolean);
  const imgs=[main,...more].map(u=>u.startsWith("http")?u:`images/${u}`);
  const root=document.getElementById("lightbox");
  const mainImg=document.getElementById("lb-mainimg");
  const thumbs=document.getElementById("lb-thumbs");
  const title=document.getElementById("lb-title");
  const spec=document.getElementById("lb-spec");
  const desc=document.getElementById("lb-desc");

  title.textContent=item["ชื่อสินค้า"]||item["รุ่นย่อย"]||"";
  mainImg.src=imgs[0]||"";
  thumbs.innerHTML="";
  imgs.forEach(u=>{
    const im=document.createElement("img");
    im.src=u;
    im.onclick=()=>mainImg.src=u;
    thumbs.appendChild(im);
  });
  spec.innerHTML=`<div><b>ราคา:</b> ${item["ราคา (THB)"]} บาท</div>`;
  desc.textContent=item["รายละเอียดเพิ่มเติม"]||"";
  root.classList.add("open");
};
document.getElementById("lb-close").onclick=()=>document.getElementById("lightbox").classList.remove("open");
document.getElementById("lightbox").onclick=e=>{if(e.target.id==="lightbox")e.currentTarget.classList.remove("open")};

// ---------- main ----------
(async()=>{
  const data=await loadCSV();
  render(data);
})();
<script>
/* === PATCH: popup ให้รองรับรูปหลายรูปจาก CSV (เวอร์ชันตรงกับ header ที่ส่งมา) === */
(function () {
  // ชื่อคอลัมน์ตามไฟล์ CSV ของเอิร์ธ
  const COL_MAIN = "ลิงก์รูปภาพหลัก";
  const COL_MORE = "ลิงก์รูปภาพเพิ่มเติม (คั่นด้วย ,)";

  function normalizeImagePath(u) {
    if (!u) return "";
    u = String(u).trim().replace(/^["']|["']$/g, "");
    if (/^https?:\/\//i.test(u)) return u;       // URL เต็ม
    if (u.startsWith("images/")) return u;       // มีโฟลเดอร์แล้ว
    return "images/" + u;                        // เป็นชื่อไฟล์ -> เติม images/
  }

  function listify(s) {
    if (!s) return [];
    // รองรับคั่นด้วย , 、 หรือ ขึ้นบรรทัดใหม่ + ตัดเว้นวรรค/quote
    const raw = String(s).trim().replace(/^["']|["']$/g, "");
    return raw.split(/[,，、\n]+/).map(x => x.trim()).filter(Boolean);
  }

  // ถ้ามีตัวแปร lb อยู่แล้ว ให้ override เฉพาะ open()
  const _lb = window.lb || (window.lb = {});
  _lb.open = function (item) {
    const main = normalizeImagePath(item[COL_MAIN]);
    const gallery = listify(item[COL_MORE]).map(normalizeImagePath);
    const imgs = [main, ...gallery].filter(Boolean);

    // DOM เดิมในหน้า
    const root    = document.getElementById("lightbox");
    const mainImg = document.getElementById("lb-mainimg");
    const thumbs  = document.getElementById("lb-thumbs");
    const title   = document.getElementById("lb-title");
    const spec    = document.getElementById("lb-spec");
    const desc    = document.getElementById("lb-desc");

    if (title) title.textContent = item["ชื่อสินค้า"] || item["รุ่นย่อย"] || item["SKU"] || "";
    if (mainImg) mainImg.src = imgs[0] || "";

    if (thumbs) {
      thumbs.innerHTML = "";
      imgs.forEach((u, i) => {
        const im = document.createElement("img");
        im.src = u; im.alt = "img" + i;
        im.addEventListener("click", () => { if (mainImg) mainImg.src = u; });
        thumbs.appendChild(im);
      });
    }

    // สเปก/ราคา (ปรับได้ตามของเดิมในหน้า)
    if (spec) {
      const bits = [];
      if (item["ราคา (THB)"]) bits.push(`<div><b>ราคา:</b> ${Number(item["ราคา (THB)"]).toLocaleString('th-TH')} บาท</div>`);
      if (item["รับประกัน (วัน)"]) bits.push(`<div><b>ประกัน:</b> ${item["รับประกัน (วัน)"]} วัน</div>`);
      spec.innerHTML = bits.join("");
    }
    if (desc) desc.textContent = item["รายละเอียดเพิ่มเติม"] || "";

    if (root) root.classList.add("open");
  };

  // ปิด popup (คงพฤติกรรมเดิม)
  document.getElementById("lb-close")?.addEventListener("click", () => {
    document.getElementById("lightbox")?.classList.remove("open");
  });
  document.getElementById("lightbox")?.addEventListener("click", (e) => {
    if (e.target === e.currentTarget) e.currentTarget.classList.remove("open");
  });
})();
</script>
</body>
</html>
