<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>JUST COM</title>
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
 --bg:#0b0e11;--panel:#0f1319;--card:#12161d;--line:#1c2430;
 --text:#e7edf3;--muted:#9aa4b2;--accent:#1f6feb;
 --radius:14px;--maxw:1200px;
}
*{box-sizing:border-box}html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font-family:'Prompt',system-ui;}
header{position:sticky;top:0;z-index:10;background:#0b0e11f0;backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
.wrap{max-width:var(--maxw);margin:auto;padding:10px 16px}
.banner{width:100%;display:block}
.container{max-width:var(--maxw);margin:14px auto;padding:0 16px}
input{background:var(--panel);color:var(--text);border:1px solid var(--line);border-radius:12px;padding:10px;width:100%;outline:none;margin-bottom:14px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
.card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);overflow:hidden;cursor:pointer;display:flex;flex-direction:column;transition:.1s}
.card:hover{transform:translateY(-3px);box-shadow:0 8px 22px rgba(0,0,0,.25)}
.thumb{width:100%;aspect-ratio:16/10;object-fit:cover;background:#0c1015}
.ct{padding:12px;display:flex;flex-direction:column;gap:8px}
.title{font-weight:800}.muted{color:var(--muted)}.price{font-weight:900}
.badges{display:flex;flex-wrap:wrap;gap:8px}.badge{background:#fff;color:#111;border-radius:999px;padding:5px 10px;font-weight:800}
.ribbon{position:absolute;top:12px;left:-36px;transform:rotate(-20deg);background:#b91c1c;color:#fff;padding:6px 56px;font-weight:900}
.empty{text-align:center;opacity:.7;margin:40px 0}
#lightbox{position:fixed;inset:0;background:rgba(0,0,0,.82);display:none;place-items:center;z-index:999}
#lightbox.open{display:grid}
.lb{width:min(96vw,1100px);max-height:90vh;background:var(--panel);border-radius:16px;overflow:hidden;display:grid;grid-template-columns:1fr 330px;position:relative}
.lb-left{background:#0b0e11;display:flex;flex-direction:column}
.lb-main-wrap{padding:12px;display:flex;align-items:center;justify-content:center}
#lb-main{width:100%;max-height:64vh;object-fit:contain;background:#000;border-radius:10px}
#lb-thumbs{padding:12px;display:grid;grid-template-columns:repeat(auto-fill,minmax(82px,1fr));gap:8px}
#lb-thumbs img{width:100%;height:82px;object-fit:cover;border:1px solid var(--line);border-radius:8px;cursor:pointer}
.lb-right{padding:16px;overflow:auto}
#lb-title{font-weight:900;font-size:18px;margin-bottom:8px}
#lb-desc{margin-top:10px;color:var(--muted)}
#lb-close{position:absolute;top:10px;right:10px;background:#111;border:1px solid #333;color:#fff;padding:6px 10px;border-radius:8px;cursor:pointer}
footer{text-align:center;color:var(--muted);font-size:13px;margin:18px 0}
</style>
</head>
<body>

<header><div class="wrap"><img class="banner" src="images/banner.png" alt="Banner"></div></header>
<div class="container">
  <h2>JUST COM</h2>
  <input id="q" placeholder="ค้นหา: ชื่อ/แบรนด์/รุ่น...">
  <div id="grid" class="grid"></div>
  <div id="empty" class="empty" style="display:none">ไม่พบสินค้า</div>
</div>
<footer>© Copyright 2025 All Rights Reserved By Just Com.</footer>

<div id="lightbox">
  <div class="lb">
    <button id="lb-close">ปิด ✕</button>
    <div class="lb-left">
      <div class="lb-main-wrap"><img id="lb-main" alt=""></div>
      <div id="lb-thumbs"></div>
    </div>
    <div class="lb-right">
      <div id="lb-title"></div>
      <div id="lb-spec"></div>
      <div id="lb-desc"></div>
    </div>
  </div>
</div>

<script>
const CONFIG={csv:"data/justcom_inventory.csv"};

function csvToArray(str,delim=","){
  const rows=str.split("\n").filter(x=>x.trim().length);
  if(!rows.length) return [];
  const headers=rows.shift().split(delim).map(h=>h.trim());
  return rows.map(row=>{
    const cols=[]; let cur="", inQ=false;
    for(let i=0;i<row.length;i++){
      const c=row[i];
      if(c=='"') inQ=!inQ;
      else if(c===delim && !inQ){ cols.push(cur); cur=""; }
      else cur+=c;
    }
    cols.push(cur);
    const obj={};
    headers.forEach((h,i)=>obj[h]=(cols[i]??"").trim());
    return obj;
  });
}

// ✅ ฟังก์ชัน listify ใหม่ (ตัด quote, trim, แยก , หรือ \n ได้ทุกแบบ)
function listify(s){
  if(!s) return [];
  return String(s)
    .replace(/["']/g,"")   // ลบ " หรือ ' ทั้งหมด
    .replace(/\r/g,"")
    .split(/[,，、\n]+/)   // แยกด้วย comma หรือบรรทัดใหม่
    .map(x=>x.trim())
    .filter(Boolean);
}

const lb={
  root:null,main:null,thumbs:null,title:null,spec:null,desc:null,
  open(it){
    const imgs=[
      it["ลิงก์รูปภาพหลัก"],
      ...listify(it["ลิงก์รูปภาพเพิ่มเติม (คั่นด้วย ,)"])
    ].filter(Boolean).map(u=>/^https?:\/\//i.test(u)?u:(u.startsWith("images/")?u:"images/"+u));

    this.main.src=imgs[0]||"";
    this.thumbs.innerHTML="";
    imgs.forEach((u,i)=>{
      const im=document.createElement("img");
      im.src=u;
      im.alt="img"+i;
      im.addEventListener("click",()=>this.main.src=u);
      this.thumbs.appendChild(im);
    });

    this.title.textContent=it["ชื่อสินค้า"]||it["รุ่นย่อย"]||it["SKU"]||"";
    this.spec.innerHTML=`<div><b>แบรนด์:</b> ${it["ยี่ห้อ/แบรนด์"]||"-"}</div>
    <div><b>รุ่น:</b> ${it["รุ่นย่อย"]||"-"}</div>
    <div><b>ประกัน:</b> ${it["รับประกัน (วัน)"]||"-"} วัน</div>
    <div><b>ราคา:</b> ${it["ราคา (THB)"]||"-"} บาท</div>`;
    this.desc.textContent=it["รายละเอียดเพิ่มเติม"]||"";
    this.root.classList.add("open");
  },
  close(){ this.root.classList.remove("open"); }
};

function initLB(){
  lb.root=document.getElementById("lightbox");
  lb.main=document.getElementById("lb-main");
  lb.thumbs=document.getElementById("lb-thumbs");
  lb.title=document.getElementById("lb-title");
  lb.spec=document.getElementById("lb-spec");
  lb.desc=document.getElementById("lb-desc");
  document.getElementById("lb-close").addEventListener("click",()=>lb.close());
  lb.root.addEventListener("click",e=>{if(e.target===lb.root)lb.close();});
}

function render(items){
  const g=document.getElementById("grid"), e=document.getElementById("empty");
  g.innerHTML="";
  if(!items.length){ e.style.display="block"; return; }
  e.style.display="none";

  items.forEach(it=>{
    if((it["สถานะประกาศ (active|hidden|sold)"]||"").toLowerCase()==="hidden")return;
    const el=document.createElement("div");
    el.className="card";
    el.innerHTML=`${(it["สถานะประกาศ (active|hidden|sold)"]||"").toLowerCase()==="sold"?"<div class='ribbon'>SOLD OUT</div>":""}
    <img class='thumb' src='${it["ลิงก์รูปภาพหลัก"]||""}'><div class='ct'><div class='title'>${it["ชื่อสินค้า"]||it["รุ่นย่อย"]||"สินค้าไม่ระบุชื่อ"}</div><div class='muted'>${it["ยี่ห้อ/แบรนด์"]||""} ${it["รุ่นย่อย"]?"• "+it["รุ่นย่อย"]:""}</div><div class='price'>${it["ราคา (THB)"]||"สอบถาม"} บาท</div></div>`;
    el.addEventListener("click",()=>lb.open(it));
    g.appendChild(el);
  });
}

async function boot(){
  initLB();
  const t=await fetch(CONFIG.csv+"?v="+Date.now());
  const data=csvToArray(await t.text());
  const q=document.getElementById("q");
  const apply=()=>{
    const kw=q.value.toLowerCase();
    const f=data.filter(it=>[it["ชื่อสินค้า"],it["ยี่ห้อ/แบรนด์"],it["รุ่นย่อย"],it["หมวดหมู่"],it["แท็ก (คั่นด้วย ,)"],it["SKU"]].join(" ").toLowerCase().includes(kw));
    render(f);
  };
  q.addEventListener("input",apply);
  apply();
}
boot();
</script>
</body>
</html>
