<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>JUST COM</title>
<style>
:root{--bg:#0b0e11;--panel:#0f1319;--card:#12161d;--muted:#9aa4b2;--text:#e7edf3;--line:#1c2430}
*{box-sizing:border-box}html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif}
.container{max-width:1200px;margin:0 auto;padding:16px}
h1{font-size:20px;margin:12px 0 8px}
.controls{display:flex;gap:12px;flex-wrap:wrap;margin:12px 0}
input{background:var(--panel);color:var(--text);border:1px solid var(--line);border-radius:10px;padding:10px 12px;outline:none;flex:1 1 280px}
#grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px;margin-top:12px}
.card{position:relative;border:1px solid var(--line);border-radius:14px;overflow:hidden;background:var(--card);cursor:pointer}
.card .thumb{width:100%;height:180px;object-fit:cover;background:#0e1217;display:block}
.card .ct{padding:12px}
.title{font-weight:700;margin:4px 0 6px;line-height:1.35}
.price{font-weight:800;margin-top:6px}
#lightbox{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.7);z-index:9999}
#lightbox.open{display:grid}
.lbpanel{width:min(1000px,90vw);max-height:88vh;background:var(--panel);border:1px solid var(--line);border-radius:16px;overflow:hidden;display:grid;grid-template-columns:1fr 320px}
.lbm{padding:14px;background:var(--card);border-right:1px solid var(--line);display:flex;flex-direction:column}
#lb-mainimg{width:100%;height:64vh;object-fit:contain;background:#0c1015;border-radius:12px}
#lb-thumbs{margin-top:10px;display:flex;gap:8px;overflow:auto}
#lb-thumbs img{width:64px;height:64px;object-fit:cover;border-radius:8px;border:1px solid var(--line);cursor:pointer}
.lbr{padding:16px 16px 24px 16px;overflow:auto}
#lb-title{font-weight:800;margin:6px 0 10px}
#lb-spec div{margin:6px 0}
#lb-desc{margin-top:10px;color:#9aa4b2}
#lb-close{position:absolute;top:8px;right:10px;background:#0000;color:#fff;border:0;font-size:16px;cursor:pointer}
</style>
</head>
<body>
<div class="container">
  <h1>JUST COM</h1>
  <div class="controls">
    <input id="q" placeholder="ค้นหา: ชื่อ/แบรนด์/รุ่น...">
  </div>
  <div id="grid"></div>
</div>

<!-- Lightbox -->
<div id="lightbox">
  <div class="lbpanel">
    <button id="lb-close">ปิด</button>
    <div class="lbm">
      <img id="lb-mainimg" alt="">
      <div id="lb-thumbs"></div>
    </div>
    <div class="lbr">
      <div id="lb-title"></div>
      <div id="lb-spec"></div>
      <div id="lb-desc"></div>
    </div>
  </div>
</div>

<script>
// โหลด CSV
async function loadCSV(){
  const res = await fetch('data/justcom_inventory.csv?v='+Date.now());
  const text = await res.text();
  const rows = text.trim().split(/\n/).map(r=>r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(c=>c.replace(/^"|"$/g,'')));
  const headers = rows.shift();
  return rows.map(r=>Object.fromEntries(headers.map((h,i)=>[h.trim(),(r[i]||'').trim()])));
}
function listify(s){
  if(!s)return[];
  return String(s).split(/[,，、\n]+/).map(x=>x.trim()).filter(Boolean);
}

// Lightbox object
const lb={root:null,main:null,thumbs:null,title:null,spec:null,desc:null,
open(item){
  const more=listify(item["ลิงก์รูปภาพเพิ่มเติม (คั่นด้วย ,)"]).map(u=>u.startsWith('http')?u:"images/"+u);
  const imgs=[item["ลิงก์รูปภาพหลัก"],...more].filter(Boolean);
  this.title.textContent=item["ชื่อสินค้า"]||item["รุ่นย่อย"]||'';
  this.main.src=imgs[0]||'';
  this.thumbs.innerHTML='';
  imgs.forEach((u,i)=>{
    const im=document.createElement('img');im.src=u;im.alt='img'+i;
    im.onclick=()=>this.main.src=u;
    this.thumbs.appendChild(im);
  });
  this.spec.innerHTML=`<div><b>ราคา:</b> ${item["ราคา (THB)"]||'-'} บาท</div>`;
  this.desc.textContent=item["รายละเอียดเพิ่มเติม"]||'';
  this.root.classList.add('open');
},
close(){this.root.classList.remove('open');}
};

function initLightbox(){
  lb.root=document.getElementById('lightbox');
  lb.main=document.getElementById('lb-mainimg');
  lb.thumbs=document.getElementById('lb-thumbs');
  lb.title=document.getElementById('lb-title');
  lb.spec=document.getElementById('lb-spec');
  lb.desc=document.getElementById('lb-desc');
  document.getElementById('lb-close').onclick=()=>lb.close();
  lb.root.onclick=e=>{if(e.target===lb.root)lb.close();};
}

function render(list){
  const grid=document.getElementById('grid');
  grid.innerHTML='';
  list.forEach(it=>{
    const img=it["ลิงก์รูปภาพหลัก"];
    const div=document.createElement('div');
    div.className='card';
    div.innerHTML=`<img class='thumb' src='${img}'><div class='ct'><div class='title'>${it["ชื่อสินค้า"]}</div><div class='price'>${it["ราคา (THB)"]} บาท</div></div>`;
    div.onclick=()=>lb.open(it);
    grid.appendChild(div);
  });
}

(async()=>{
  initLightbox();
  const data=await loadCSV();
  render(data);
})();
</script>
</body>
</html>
