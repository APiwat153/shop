<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>JUST COM</title>
<style>
body{margin:0;font-family:Prompt,sans-serif;background:#0b0e11;color:#fff}
.banner{width:100%;display:block}
.wrap{max-width:1200px;margin:auto;padding:10px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:16px}
.card{background:#12161c;border:1px solid #1e2530;border-radius:12px;overflow:hidden;position:relative}
.thumb{width:100%;aspect-ratio:16/9;object-fit:cover;background:#000}
.ct{padding:10px}
.title{font-weight:700}
.muted{color:#aaa;font-size:0.9rem}
.price{margin-top:5px;font-weight:900}
.ribbon{position:absolute;top:10px;left:-36px;transform:rotate(-20deg);background:#e63946;color:#fff;
padding:6px 60px;font-weight:900;box-shadow:0 4px 8px rgba(0,0,0,.3)}
footer{text-align:center;color:#888;padding:20px;font-size:0.85rem}

/* popup */
#popup{position:fixed;inset:0;background:rgba(0,0,0,0.8);display:none;align-items:center;justify-content:center;z-index:100}
#popup.open{display:flex}
.popup-box{background:#111820;border-radius:12px;max-width:900px;width:95%;overflow:hidden;display:grid;grid-template-columns:1fr 340px}
.popup-main{display:flex;align-items:center;justify-content:center;background:#000;padding:10px}
.popup-main img{max-width:100%;max-height:80vh;object-fit:contain}
.popup-info{padding:14px}
.popup-thumbs{display:flex;flex-wrap:wrap;gap:6px;padding:8px;border-top:1px solid #222;background:#0f0f0f}
.popup-thumbs img{width:70px;height:70px;object-fit:cover;border-radius:6px;border:1px solid #222;cursor:pointer}
.close-btn{position:absolute;top:8px;right:12px;background:#000;border:1px solid #444;color:#fff;border-radius:8px;padding:4px 8px;cursor:pointer}
</style>
</head>
<body>
<img src="images/banner.png" alt="banner" class="banner">
<div class="wrap">
<h2>JUST COM</h2>
<input id="search" placeholder="ค้นหาชื่อสินค้า..." style="width:100%;padding:8px;background:#111;border:1px solid #333;color:#fff;border-radius:6px">
<div id="grid" class="grid"></div>
</div>
<footer>© Copyright 2025 Just Com</footer>

<div id="popup">
  <div class="popup-box">
    <div class="popup-main"><img id="pimg" src=""></div>
    <div class="popup-info">
      <button class="close-btn" id="pclose">ปิด</button>
      <h3 id="ptitle"></h3>
      <p id="pdesc" style="color:#aaa;font-size:0.9rem"></p>
      <div id="pthumbs" class="popup-thumbs"></div>
    </div>
  </div>
</div>

<script>
async function loadCSV(url){
  const t=await fetch(url+"?v="+Date.now()).then(r=>r.text());
  const [header,...lines]=t.trim().split("\n");
  const h=header.split(",");
  return lines.map(l=>{
    const c=l.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(x=>x.replace(/^"|"$/g,""));
    const o={}; h.forEach((v,i)=>o[v.trim()]=c[i]?c[i].trim():"");
    return o;
  });
}
function imgs(it){
  const all=[];
  const add=s=>{
    if(!s)return;
    s.replace(/["']/g,"").split(/[,，、\n]+/).forEach(x=>{
      x=x.trim();if(!x)return;
      // ✅ ถ้าเป็น URL ใช้ตรง ๆ ถ้าไม่ใช่ให้ต่อ images/
      all.push(/^https?:\/\//i.test(x)?x:"images/"+x);
    });
  };
  add(it["ลิงก์รูปภาพหลัก"]);
  add(it["ลิงก์รูปภาพเพิ่มเติม (คั่นด้วย ,)"]);
  return [...new Set(all)];
}

const popup={
  root:null,img:null,title:null,desc:null,thumbs:null,
  open(it){
    const list=imgs(it);
    this.img.src=list[0]||"";
    this.title.textContent=it["ชื่อสินค้า"]||"";
    this.desc.textContent=`แบรนด์: ${it["ยี่ห้อ/แบรนด์"]||"-"} | รุ่น: ${it["รุ่นย่อย"]||"-"} | ราคา: ${it["ราคา (THB)"]||"-"} บาท`;
    this.thumbs.innerHTML="";
    list.forEach((u,i)=>{
      const im=document.createElement("img");
      im.src=u;im.alt="img"+i;
      im.onclick=()=>this.img.src=u;
      this.thumbs.appendChild(im);
    });
    this.root.classList.add("open");
  },
  close(){this.root.classList.remove("open");}
};

async function boot(){
  popup.root=document.getElementById("popup");
  popup.img=document.getElementById("pimg");
  popup.title=document.getElementById("ptitle");
  popup.desc=document.getElementById("pdesc");
  popup.thumbs=document.getElementById("pthumbs");
  document.getElementById("pclose").onclick=()=>popup.close();
  popup.root.onclick=e=>{if(e.target===popup.root)popup.close();};

  const data=await loadCSV("data/justcom_inventory.csv");
  render(data);
  document.getElementById("search").oninput=e=>{
    const kw=e.target.value.toLowerCase();
    render(data.filter(x=>(x["ชื่อสินค้า"]+x["ยี่ห้อ/แบรนด์"]+x["รุ่นย่อย"]).toLowerCase().includes(kw)));
  };
}

function render(items){
  const grid=document.getElementById("grid");
  grid.innerHTML="";
  items.forEach(it=>{
    const pic=imgs(it)[0]||"";
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
      ${(it["สถานะประกาศ (active|hidden|sold)"]||"").toLowerCase()==="sold"?'<div class="ribbon">SOLD OUT</div>':""}
      <img src="${pic}" class="thumb" alt="">
      <div class="ct">
        <div class="title">${it["ชื่อสินค้า"]||"-"}</div>
        <div class="muted">${it["ยี่ห้อ/แบรนด์"]||""} ${it["รุ่นย่อย"]?("• "+it["รุ่นย่อย"]):""}</div>
        <div class="price">${Number(it["ราคา (THB)"]||0).toLocaleString("th-TH")} บาท</div>
      </div>`;
    card.onclick=()=>popup.open(it);
    grid.appendChild(card);
  });
}
boot();
</script>
</body>
</html>
