<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>JUST COM</title>
  <style>
    :root {
      --bg: #0b0e11;
      --card: #111620;
      --line: #1f2937;
      --muted: #9aa4b2;
      --white: #fff;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, "Noto Sans Thai", sans-serif;
      background: var(--bg);
      color: var(--white);
    }

    header {
      background: var(--bg);
      border-bottom: 1px solid var(--line);
    }

    header img {
      display: block;
      width: 100%;
      height: auto;
    }

    .container {
      max-width: 1200px;
      margin: 20px auto;
      padding: 0 16px;
    }

    h1 {
      margin: 0;
      font-size: 1.6rem;
      font-weight: 800;
    }

    input {
      background: #111;
      border: 1px solid #333;
      border-radius: 6px;
      color: #fff;
      padding: 8px 12px;
      width: 100%;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 18px;
      margin-top: 18px;
    }

    .card {
      background: var(--card);
      border-radius: 12px;
      border: 1px solid var(--line);
      overflow: hidden;
      position: relative;
      cursor: pointer;
      transition: transform 0.15s ease;
    }

    .card:hover { transform: translateY(-3px); }

    .thumb {
      width: 100%;
      aspect-ratio: 16/10;
      object-fit: cover;
      display: block;
      background: #000;
    }

    .ct {
      padding: 12px;
    }

    .title {
      font-weight: 700;
      font-size: 1rem;
    }

    .muted {
      color: var(--muted);
      font-size: 0.9rem;
    }

    .price {
      font-weight: 900;
      font-size: 1.05rem;
      margin-top: 4px;
    }

    .ribbon {
      position: absolute;
      top: 12px;
      left: -36px;
      transform: rotate(-20deg);
      background: #e64;
      color: #fff;
      padding: 6px 56px;
      font-weight: 900;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      font-size: 0.85rem;
    }

    footer {
      text-align: center;
      color: #9aa4b2;
      padding: 20px;
      font-size: 0.85rem;
    }

    /* Lightbox */
    #lightbox {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.75);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    #lightbox.open { display: flex; }

    .lb {
      display: grid;
      grid-template-columns: 1fr 340px;
      background: #0b0e11;
      border-radius: 12px;
      overflow: hidden;
      max-width: 1000px;
      width: 95%;
      max-height: 90vh;
    }

    .lb-main {
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
      padding: 10px;
    }

    .lb-main img {
      max-width: 100%;
      max-height: 80vh;
      object-fit: contain;
    }

    .lb-side {
      padding: 16px;
      overflow-y: auto;
    }

    .lb-title {
      font-weight: 800;
      font-size: 1.1rem;
    }

    .lb-spec {
      margin-top: 10px;
      color: var(--muted);
      font-size: 0.9rem;
      line-height: 1.5;
    }

    .lb-thumbs {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 10px;
      border-top: 1px solid var(--line);
      background: #0f0f0f;
    }

    .lb-thumbs img {
      width: 72px;
      height: 72px;
      object-fit: cover;
      cursor: pointer;
      border-radius: 6px;
      border: 1px solid #222;
      transition: transform 0.2s ease;
    }

    .lb-thumbs img:hover { transform: scale(1.05); }

    .lb-close {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #111;
      border: 1px solid #444;
      border-radius: 6px;
      color: #fff;
      padding: 4px 8px;
      cursor: pointer;
    }

  </style>
</head>
<body>

  <header>
    <img src="images/banner.png" alt="Banner" />
  </header>

  <div class="container">
    <h1>JUST COM</h1>
    <p style="color:#aaa;font-size:0.9rem;">จำหน่ายอุปกรณ์คอมมือหนึ่ง มือสอง พร้อมให้คำปรึกษา</p>
    <input id="search" placeholder="ค้นหาชื่อสินค้า หรือแบรนด์..." />

    <div id="grid" class="grid"></div>
    <div id="empty" style="display:none;text-align:center;margin:20px 0;opacity:0.7;">ไม่พบสินค้า</div>
  </div>

  <footer>© Copyright 2025 All Rights Reserved By Just Com.</footer>

  <!-- Lightbox -->
  <div id="lightbox">
    <div class="lb">
      <div class="lb-main">
        <img id="lb-main" src="" alt="">
      </div>
      <div class="lb-side">
        <div class="lb-title" id="lb-title"></div>
        <div class="lb-spec" id="lb-spec"></div>
      </div>
      <div class="lb-thumbs" id="lb-thumbs"></div>
      <button id="lb-close" class="lb-close">ปิด</button>
    </div>
  </div>

  <script>
    async function loadCSV(path){
      const res = await fetch(path + "?v=" + Date.now());
      const txt = await res.text();
      const rows = txt.replace(/\uFEFF/g,"").trim().split("\n");
      const headers = rows.shift().split(",");
      return rows.map(line=>{
        const cols = line.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/);
        const o = {};
        headers.forEach((h,i)=>o[h.trim()] = (cols[i]||"").trim().replace(/^"|"$/g,""));
        return o;
      });
    }

    function imagesFromItem(it){
      const all = [];
      const add = s=>{
        if(!s) return;
        s.replace(/["']/g,"").split(/[,，、\n]+/).forEach(x=>{
          const t = x.trim();
          if(t) all.push(/^https?:\/\//i.test(t)?t:("images/"+t));
        });
      };
      add(it["ลิงก์รูปภาพหลัก"]);
      add(it["ลิงก์รูปภาพเพิ่มเติม (คั่นด้วย ,)"]);
      return [...new Set(all)];
    }

    const lb = {
      root:null, main:null, thumbs:null, title:null, spec:null,
      open(it){
        const imgs = imagesFromItem(it);
        this.main.src = imgs[0]||"";
        this.thumbs.innerHTML="";
        imgs.forEach((u,i)=>{
          const im=document.createElement("img");
          im.src=u;im.alt="img"+i;
          im.onclick=()=>this.main.src=u;
          this.thumbs.appendChild(im);
        });
        this.title.textContent=it["ชื่อสินค้า"]||"";
        this.spec.innerHTML=`<b>แบรนด์:</b> ${it["ยี่ห้อ/แบรนด์"]||"-"}<br>
                             <b>รุ่น:</b> ${it["รุ่นย่อย"]||"-"}<br>
                             <b>ประกัน:</b> ${it["รับประกัน (วัน)"]||"-"} วัน<br>
                             <b>ราคา:</b> ${Number(it["ราคา (THB)"]||0).toLocaleString('th-TH')} บาท`;
        this.root.classList.add("open");
      },
      close(){ this.root.classList.remove("open"); }
    };

    async function boot(){
      lb.root=document.getElementById("lightbox");
      lb.main=document.getElementById("lb-main");
      lb.thumbs=document.getElementById("lb-thumbs");
      lb.title=document.getElementById("lb-title");
      lb.spec=document.getElementById("lb-spec");
      document.getElementById("lb-close").onclick=()=>lb.close();
      lb.root.onclick=e=>{if(e.target===lb.root)lb.close();};

      const data=await loadCSV("data/justcom_inventory.csv");
      render(data);

      document.getElementById("search").addEventListener("input",e=>{
        const kw = e.target.value.trim().toLowerCase();
        const filtered = data.filter(it=>{
          const text = [it["ชื่อสินค้า"],it["ยี่ห้อ/แบรนด์"],it["รุ่นย่อย"],it["หมวดหมู่"]].join(" ").toLowerCase();
          return text.includes(kw);
        });
        render(filtered);
      });
    }

    function render(items){
      const grid = document.getElementById("grid");
      const empty = document.getElementById("empty");
      grid.innerHTML="";
      if(!items.length){ empty.style.display="block"; return;}
      empty.style.display="none";

      items.forEach(it=>{
        const imgs = imagesFromItem(it);
        const cover = imgs[0]||"";
        const status = (it["สถานะประกาศ (active|hidden|sold)"]||"active").toLowerCase();
        const card = document.createElement("div");
        card.className="card";
        card.innerHTML = `
          ${status==="sold"?`<div class="ribbon">SOLD OUT</div>`:""}
          <img class="thumb" src="${cover}" alt="">
          <div class="ct">
            <div class="title">${it["ชื่อสินค้า"]||"ไม่ระบุชื่อ"}</div>
            <div class="muted">${it["ยี่ห้อ/แบรนด์"]||""} ${it["รุ่นย่อย"]?("• "+it["รุ่นย่อย"]):""}</div>
            <div class="price">${Number(it["ราคา (THB)"]||0).toLocaleString('th-TH')} บาท</div>
          </div>`;
        card.onclick = ()=>lb.open(it);
        grid.appendChild(card);
      });
    }

    boot();
  </script>
</body>
</html>
